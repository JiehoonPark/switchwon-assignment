# Switchwon Exchange Assignment

## 프로젝트 개요

환율 조회, 지갑 잔액 확인, 환전 견적/주문, 거래 내역 확인까지 가능한 환전 클라이언트입니다.  
요구사항에 맞춰 로그인 기반 인증, 라우트 보호, 1분 주기 환율 갱신을 구현했습니다.

## 배포주소

https://switchwon-assignment.vercel.app

## 로컬 실행 방법

```
npm install
npm run dev
```

## 기술 스택 및 선택 이유

- Next.js (App Router): 라우팅과 서버 Route Handler를 함께 사용해 CORS 제약을 우회하고 인증 흐름을 안정적으로 구성했습니다.
- React + TypeScript: 상태/비동기 흐름을 명확히 모델링하고 타입 기반으로 API 계약을 관리했습니다.
- Tailwind CSS: 디자인 토큰 기반으로 빠르게 UI를 구성하고 일관된 스타일을 유지했습니다.
- TanStack Query: 데이터 캐싱/폴링/재시도 제어가 필요해 표준적인 비동기 상태 관리로 채택했습니다.
- shadcn/ui (Radix 기반): 접근성 높은 컴포넌트를 기반으로 커스텀 스타일을 적용하기 위해 사용했습니다.
- lucide-react: 심플한 아이콘 세트를 통해 UI 통일성을 유지했습니다.

## 폴더 구조 (FSD v2.1 기반)

FSD v2.1 기준 구조로 구성했습니다.  
Next.js App Router 제약 때문에 라우팅은 프로젝트 루트 `app/`에서 처리하고, 실제 페이지 구현은 `src/pages`에서 관리합니다.  
루트 `pages/` 폴더는 App Router와 Pages Router 충돌 방지를 위한 빈 폴더입니다.

```
app/                              # Next.js App Router (라우트 엔트리)
  (public)/login/page.tsx         # 공개 라우트
  (protected)/exchange/page.tsx   # 보호 라우트
  (protected)/orders/page.tsx
  api/                            # API route (src/app/api-routes re-export)
pages/                            # 빈 pages 폴더 (App Router 충돌 방지)
src/
  app/
    providers/                    # 전역 Provider
    api-routes/                   # 서버 프록시 Route Handler
  pages/
    login/ui/                     # 페이지 UI (FSD pages)
    exchange/ui/
    orders/ui/
  widgets/
    exchange-dashboard/           # 대시보드 위젯
    order-history/                # 내역 위젯
    global-navigation-bar/
  features/
    auth/                         # 인증 기능
      api/ model/ server/ lib/ config/ ui/
    exchange/                     # 환전 기능
      api/ model/ ui/
  entities/
    order/ model/
    exchange-rate/ model/
    wallet/ model/
  shared/
    api/ config/ lib/ ui/
```

## 기능구현

### 1) 인증/토큰 관리

- `/api/auth/login` Route Handler에서 백엔드 로그인 API를 프록시 호출하고, 발급된 JWT를 httpOnly 쿠키로 저장했습니다.
- CORS 제한을 우회하고 토큰을 안전하게 보관하기 위해서입니다.
- 인증 만료 시 `?reason=unauthorized`로 로그인 페이지에 리다이렉트하고, 모달로 안내 메시지를 표시합니다.

### 2) 라우트 보호

- `app/(protected)/layout.tsx`에서 서버 측 `requireAuth()`를 호출해 보호합니다.
- 클라이언트 렌더링 전에 인증 여부를 확정해 불필요한 화면 깜빡임을 줄였습니다.

### 3) 환율/지갑 조회

- TanStack Query로 `GET /exchange-rates/latest`, `GET /wallets`를 호출합니다. 환율은 1분 폴링으로 최신 값을 유지합니다.
- 데이터 갱신 주기를 명확히 유지하고, 캐시를 통해 UI 안정성을 높이려는 목적이었습니다.

### 4) 환전 견적/주문

- 입력값을 디바운스 후 `GET /orders/quote`로 견적을 조회하고, `POST /orders`로 주문을 실행합니다. 주문 성공 시 지갑/내역 캐시를 갱신합니다.
- 불필요한 요청을 줄이고, 주문 후 데이터 일관성을 유지하기 위한 선택이었습니다.
- 유효하지 않은 입력 시 서버 메시지를 그대로 표시하고, 최근 정상 견적을 보관해 화면 깜빡임을 최소화했습니다.

### 5) 거래 내역

- `GET /orders`를 호출해 목록을 표시하고, 로딩/빈 상태 UI를 제공했습니다.
- 컬럼 폭을 고정하고 `nowrap + 가로 스크롤`을 적용해 로딩/데이터 전환 및 모바일 환경에서 레이아웃 흔들림을 줄이려 했습니다.
- 데이터 상태에 따른 피드백을 명확히 해 사용성을 높였습니다.

## 고려사항들

### 문제 해결 경험

#### 1) 환전 견적 UI 깜빡임

입력 중 견적/에러 메시지가 0 또는 `-`로 튀며 깜빡이는 문제가 있었습니다. 디바운스된 입력과 “정착된 응답”을 분리해 UI에 반영하는 방향으로 접근했고, 요청/응답 상태가 빠르게 전환되면서 캐시가 교차되는 흐름을 확인했습니다. 정상 응답, 로딩, 에러가 동일 UI에 동시에 반영되는 구조가 원인으로 보였고, 입력값 키 기준으로 정착된 견적만 표시하며 에러 발생 시 placeholder로 고정하도록 수정해 화면 흔들림을 줄였습니다.

#### 2) 인증 만료 후 반복 요청

토큰 만료 후에도 폴링과 요청이 계속 발생해 UX가 저하되는 문제가 있었습니다. 전역 에러 처리에서 UNAUTHORIZED를 공통 감지하도록 접근했고, 쿼리별 처리로 리다이렉트 타이밍이 일관되지 않은 점을 확인했습니다. 공통 인증 만료 핸들러가 없다는 점이 원인으로 판단되어 QueryProvider와 httpClient에서 인증 만료 시 로그아웃 및 로그인 페이지 리다이렉트를 수행하도록 통일해 재요청을 줄였습니다.

### 고려 사항

- **보안**: 토큰을 로컬스토리지 대신 httpOnly 쿠키로 관리했습니다. XSS 노출 위험을 줄이고, 서버가 Set-Cookie로 쿠키 속성/만료를 일관되게 설정할 수 있어 인증 흐름을 안정화했습니다.
- **CORS 대응**: 클라이언트 직접 호출 대신 Next Route Handler 프록시를 사용했습니다. 브라우저 동일 출처 정책을 우회하면서도 요청/응답 구조를 유지할 수 있다고 보았습니다.
- **예측 가능성**: API 에러 메시지는 서버 응답을 그대로 사용해 중복 정의를 피했습니다. 클라이언트가 메시지를 재정의하면 실제 서버 상태와 불일치가 생길 수 있어 원인 추적이 어렵다고 생각했습니다.
- **응집도/결합도**: FSD 레이어/세그먼트 분리와 Public API(index.ts)로 캡슐화를 유지했습니다. 변경 범위를 레이어 내부로 제한해 수정 영향도를 줄이려는 목적이었습니다.
- **UI 안정성**: 입력 디바운스와 정착된(Last valid) 상태를 유지해 깜빡임을 완화했습니다. 사용자가 빠르게 입력할 때도 값이 튀지 않도록 상태 흐름을 분리했습니다.

### 추가 개선

- 입력값 정규화 및 정수부 길이 제한으로 과도한 숫자 입력을 1차 차단했습니다. 서버 VALIDATION_ERROR 발생 가능성과 불필요한 요청을 줄이고 UX를 안정화하려 했습니다.
- 거래 내역 테이블에 스켈레톤과 고정 헤더를 적용해 레이아웃 흔들림을 줄이려 했습니다. 로딩 중에도 컨텍스트를 유지하려는 이유입니다.
- 전역 Query 에러 처리로 인증 만료 시 자동 로그아웃/리다이렉트를 구현했습니다. 개별 화면에서 중복 처리하지 않도록 하기 위함입니다.
- 모바일 GNB는 햄버거 토글로 드롭다운 형태의 메뉴를 제공해 작은 화면에서도 기능 탐색을 유지하려 했습니다.
- 환전 확인 금액 영역은 숫자/설명 문구를 분리해 긴 금액에서도 박스 이탈을 줄이려 했습니다.
- 환전 페이지는 모바일 환경을 고려해 레이아웃을 조정했습니다.
- 토큰 만료는 즉시 리다이렉트하고, 로그인 페이지에서 모달로 안내하도록 구성했습니다. 화면 전환 직후 상태 변화를 확실히 인지할 수 있고, 토스트보다 시각적 주의도가 높아 로그인 폼 흐름과 겹칠 가능성이 낮다고 판단했습니다.
